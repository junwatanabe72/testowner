# オーナーページ カレンダー機能設計書

## 1. 概要

ビルオーナー向け管理画面に、ビル管理に関わる全ての予定を一元管理できるカレンダー機能を実装します。Googleカレンダーのような月間表示と、ガントチャート形式の週間・日次表示を組み合わせた2つのビューを提供します。

## 2. 機能要件

### 2.1 カレンダービュー

#### 月間カレンダー（Googleカレンダー風）
- 1ヶ月分の予定を俯瞰できるグリッド表示
- 各日付セルに予定をコンパクトに表示
- 予定の種類によって色分け
- クリックで詳細表示
- 前月・次月への切り替え機能

#### 週間・日次ガントチャート
- 時間軸を横軸とした横長表示
- 各予定の時間帯を視覚的に表現
- 予定の重複を分かりやすく表示
- リアルタイムで現在時刻をハイライト

### 2.2 表示する情報

#### 内見予約
- 予約時間、階数、仲介会社名、顧客名
- ステータス（承認待ち、承認済み、完了、キャンセル）
- 色: 青系（#2196F3）

#### 入居申込関連
- 申込受付、審査期限、契約予定日
- ステータス（審査中、承認済み、却下）
- 色: 緑系（#4CAF50）

#### メンテナンス・工事
- 定期点検（エレベーター、空調、消防設備等）
- 工事予定（清掃、修繕、改修）
- 色: オレンジ系（#FF9800）

#### テナント関連
- 契約更新期限
- 退去予定日
- 入居予定日
- 色: 紫系（#9C27B0）

#### その他イベント
- 会議室予約
- 駐車場利用申請
- その他施設利用
- 色: グレー系（#757575）

## 3. UI/UX設計

### 3.1 レイアウト

```
┌─────────────────────────────────────────────────────────┐
│  オーナーダッシュボード                                    │
├─────────────────────────────────────────────────────────┤
│  [月間] [週間] [日次]  < 2025年8月 >  [今日] [新規予定]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  月間カレンダー / 週間・日次ガントチャート              │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  今日の予定サマリー                                      │
│  ・10:00 5階内見（エステート不動産）                    │
│  ・14:00 エレベーター定期点検                           │
│  ・16:00 6階内見（総合不動産サービス）                  │
└─────────────────────────────────────────────────────────┘
```

### 3.2 配置場所

- **メインナビゲーション**: 新規タブ「カレンダー」を追加
- **ダッシュボード**: サマリーカードに「今日の予定」を追加
- **位置**: ダッシュボードの活動履歴の上に配置

### 3.3 インタラクション

#### 月間カレンダー
- 日付セルをクリック → その日の予定リストをポップアップ表示
- 予定をクリック → 詳細ダイアログ表示
- ドラッグ&ドロップで予定の日付変更（将来機能）

#### ガントチャート
- 予定バーをクリック → 詳細ダイアログ表示
- マウスホバー → ツールチップで概要表示
- 時間軸のズームイン/アウト機能

## 4. データ構造

### 4.1 カレンダーイベント型定義

```typescript
interface CalendarEvent {
  id: string;
  type: 'viewing' | 'application' | 'maintenance' | 'tenant' | 'facility';
  title: string;
  description?: string;
  startDate: string; // ISO 8601
  endDate?: string; // ISO 8601
  startTime?: string; // HH:mm
  endTime?: string; // HH:mm
  location?: string; // 階数や場所
  participants?: string[]; // 関係者
  status?: string;
  color: string;
  metadata?: {
    floorNumber?: number;
    brokerCompany?: string;
    tenantName?: string;
    contractorName?: string;
    [key: string]: any;
  };
}
```

### 4.2 データソース

既存のReduxストアから以下のデータを取得・変換：
- `viewingReservations` → 内見予約イベント
- `tenantApplications` → 入居申込関連イベント
- `activities` → メンテナンス・工事イベント
- `building.floors` → テナント契約情報

## 5. 技術仕様

### 5.1 使用ライブラリ

- **月間カレンダー**: `react-big-calendar` または自作グリッドコンポーネント
- **ガントチャート**: `react-gantt-timeline` または自作タイムラインコンポーネント
- **日付操作**: `date-fns` または `dayjs`
- **状態管理**: Redux Toolkit（既存）

### 5.2 コンポーネント構成

```
/features/owner/components/
  ├── Calendar/
  │   ├── CalendarContainer.tsx    // メインコンテナ
  │   ├── MonthlyCalendar.tsx     // 月間カレンダー
  │   ├── WeeklyGantt.tsx         // 週間ガントチャート
  │   ├── DailyGantt.tsx          // 日次ガントチャート
  │   ├── EventDetail.tsx         // イベント詳細ダイアログ
  │   ├── TodaySummary.tsx        // 今日の予定サマリー
  │   └── utils/
  │       ├── eventTransformers.ts // データ変換ユーティリティ
  │       └── calendarHelpers.ts   // カレンダー関連ヘルパー
```

## 6. 実装優先順位

1. **Phase 1**: 基本機能
   - 月間カレンダーの実装
   - 既存データの変換・表示
   - 今日の予定サマリー

2. **Phase 2**: 拡張機能
   - 週間・日次ガントチャート
   - イベント詳細表示
   - フィルタリング機能

3. **Phase 3**: 高度な機能
   - 予定の追加・編集機能
   - ドラッグ&ドロップ
   - 外部カレンダー連携

## 7. パフォーマンス考慮事項

- イベントデータのメモ化
- 仮想スクロール（大量イベント対応）
- 遅延読み込み（月次データのみ初期表示）

## 8. アクセシビリティ

- キーボードナビゲーション対応
- スクリーンリーダー対応
- 高コントラストモード対応
- モバイルレスポンシブ対応

## 9. 将来の拡張性

- iCal/Google Calendar連携
- 通知・リマインダー機能
- 繰り返し予定の設定
- 複数ビルの統合カレンダー表示